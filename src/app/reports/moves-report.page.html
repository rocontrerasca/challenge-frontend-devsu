<div class="card">
  <h2>Reporte de Movimientos</h2>

  <form [formGroup]="form" class="form" (ngSubmit)="onSearch()">
    <div class="field field--6">
      <label>Cliente</label>
      <select class="input" formControlName="clientId">
        <option value="" disabled>Seleccione un cliente</option>
        <option *ngFor="let c of clients()" [value]="c.clientId">{{ c.fullName }}</option>
      </select>
      <div class="help" *ngIf="submitted && form.controls.clientId.invalid">Seleccione un cliente</div>
    </div>

    <div class="field field--3">
      <label>Fecha inicio</label>
      <input class="input" type="date" formControlName="from" />
      <div class="help" *ngIf="submitted && form.controls.from.invalid">Requerida</div>
    </div>

    <div class="field field--3">
      <label>Fecha fin</label>
      <input class="input" type="date" formControlName="to" />
      <div class="help" *ngIf="submitted && form.controls.to.invalid">Requerida</div>
    </div>

    <div class="row-nowrap" style="margin-top:8px;">
      <button class="btn" type="submit">Buscar</button>
      <span class="spacer"></span>
      <span class="muted" *ngIf="loading()">Procesando…</span>
    </div>
  </form>
</div>

<div class="card">
  <h3>Resultados</h3>

  <div class="table-wrap" *ngIf="rows().length; else empty">
    <table class="table">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Cliente</th>
          <th>Número cuenta</th>
          <th>Tipo</th>
          <th>Saldo inicial</th>
          <th>Estado</th>
          <th>Movimiento</th>
          <th>Saldo final</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of rows()">
          <td>{{ r.transactionDate | date:'yyyy-MM-dd HH:mm' }}</td>
          <td>{{ r.client }}</td>
          <td>{{ r.account }}</td>
          <td>{{ r.accountType }}</td>
          <td>{{ r.initialBalance | number:'1.2-2' }}</td>
          <td>
            <span class="badge" [class.ok]="r.success" [class.off]="!r.success">
              {{ r.success ? 'Éxito' : 'Falló' }}
            </span>
          </td>
          <td [ngClass]="{ 'muted': r.amount === 0 }">
            {{ r.amount | number:'1.2-2' }}
          </td>
          <td>{{ r.finalBalance | number:'1.2-2' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #empty>
    <div class="muted">Sin resultados. Ajusta el rango de fechas y cliente y vuelve a buscar.</div>
  </ng-template>
</div>
